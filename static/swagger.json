{
  "openapi": "3.0.0",
  "info": {
    "title": "API de Riscos Psicossociais",
  "description": "**Bem-vindo(a) ao Sistema de Avalia√ß√£o de Riscos Psicossociais!** üß†üíº\n\nEsta ferramenta permite que organiza√ß√µes identifiquem fatores que afetam a sa√∫de mental e o bem-estar no ambiente de trabalho, gerando insights valiosos e recomenda√ß√µes pr√°ticas para melhorias.\n\n### üåü Principais recursos:\n- Baseado no Participative, Rapid and Detailed Psychosocial Risk Questionnaire (PRD‚ÄìPRQ) de Bolis et. al (2024)\n- Question√°rio intuitivo em dois n√≠veis para maior efici√™ncia\n- Organiza√ß√£o hier√°rquica em macrotemas, temas e subtemas\n- Relat√≥rios estat√≠sticos detalhados com visualiza√ß√µes\n- Recomenda√ß√µes personalizadas com base na classifica√ß√£o de risco\n- Filtragem por empresa e departamento para an√°lises espec√≠ficas\n\nMVP desenvolvido para atendimento das demandas da Sprint: Desenvolvimento Full Stack B√°sico da Especializa√ß√£o em Engenharia de Software da PUC-RIO.",
    "version": "1.0.0",
    "contact": {
      "name": ": perseupadre@gmail.com",
      "email": "perseupadre@gmail.com"
    },
    "license": {
      "name": "PUC-Rio - Engenharia de Software - Projeto MVP",
      "url": "https://www.puc-rio.br"
    }
  },
  "servers": [
    {
      "url": "http://localhost:5000",
      "description": "Servidor local para desenvolvimento e teste"
    }
  ],
  "tags": [
    {
      "name": "question√°rio",
      "description": "üìã Explore a estrutura e os conte√∫dos do question√°rio de avalia√ß√£o"
    },
    {
      "name": "avalia√ß√£o",
      "description": "‚úÖ Registre e gerencie avalia√ß√µes de riscos psicossociais"
    },
    {
      "name": "relat√≥rio",
      "description": "üìä Gere an√°lises estat√≠sticas, visualiza√ß√µes e recomenda√ß√µes"
    },
    {
      "name": "administra√ß√£o",
      "description": "‚öôÔ∏è Ferramentas para configura√ß√£o e manuten√ß√£o do sistema"
    }
  ],
  "paths": {
    "/obter_questionario": {
      "get": {
        "tags": ["question√°rio"],
        "summary": "Obtenha o question√°rio completo organizado hierarquicamente",
        "description": "Retorna a estrutura completa do question√°rio, organizando todos os elementos em uma hierarquia de **5 macrotemas** (categorias A-E), **20 temas** numerados (quest√µes principais) e seus respectivos **subtemas** (aspectos espec√≠ficos de cada tema).\n\nIdeal para construir a interface de avalia√ß√£o e exibir as perguntas ao usu√°rio de forma organizada.",
        "operationId": "obterQuestionario",
        "responses": {
          "200": {
            "description": "‚úì Question√°rio obtido com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/QuestionarioHierarquico"
                },
                "example": {
                  "questionario": [
                    {
                      "id": 1,
                      "codigo": "A",
                      "titulo": "Sobre diferentes cargas de trabalho",
                      "temas": [
                        {
                          "id": 1,
                          "numero": 1,
                          "descricao": "Meu trabalho √© caracterizado por alta intensidade e um ritmo acelerado de trabalho.",
                          "subtemas": [
                            {
                              "id": 1,
                              "letra": "a",
                              "descricao": "Preciso trabalhar muito r√°pido ou com muito esfor√ßo ao longo do dia"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "‚ùå Erro ao processar a solicita√ß√£o",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          }
        }
      }
    },
    "/cadastrar_avaliacao": {
      "post": {
        "tags": ["avalia√ß√£o"],
        "summary": "Registre uma nova avalia√ß√£o completa",
        "description": "Envie uma avalia√ß√£o de riscos psicossociais com dados de identifica√ß√£o e respostas do question√°rio nos dois n√≠veis:\n\n1Ô∏è‚É£ **Primeiro n√≠vel**: Sele√ß√£o de temas relevantes para o contexto avaliado (Sim/N√£o)\n\n2Ô∏è‚É£ **Segundo n√≠vel**: Para cada tema selecionado, avalia√ß√£o do grau de desconforto (0-5) para os subtemas relacionados\n\nO sistema inclui prote√ß√£o contra submiss√µes duplicadas recentes.",
        "operationId": "cadastrarAvaliacao",
        "requestBody": {
          "description": "Dados completos da avalia√ß√£o",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NovaAvaliacao"
              },
              "example": {
                "empresa": "PUC-Rio",
                "departamento": "Engenharias",
                "funcao": "Professor",
                "respostas_nivel1": [
                  {"tema_id": 1, "selecionado": true},
                  {"tema_id": 4, "selecionado": true},
                  {"tema_id": 8, "selecionado": true}
                ],
                "respostas_nivel2": [
                  {"subtema_id": 1, "nivel_desconforto": 3},
                  {"subtema_id": 2, "nivel_desconforto": 4},
                  {"subtema_id": 12, "nivel_desconforto": 2}
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "‚úì Avalia√ß√£o registrada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RespostaAvaliacao"
                }
              }
            }
          },
          "400": {
            "description": "‚ùå Dados de avalia√ß√£o inv√°lidos ou incompletos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          },
          "500": {
            "description": "‚ùå Erro ao processar a solicita√ß√£o",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          }
        }
      }
    },
    "/gerar_relatorio": {
      "get": {
        "tags": ["relat√≥rio"],
        "summary": "Gere relat√≥rios estat√≠sticos detalhados com recomenda√ß√µes",
        "description": "Cria um relat√≥rio completo com an√°lise estat√≠stica das avalia√ß√µes, incluindo:\n\nüìä **Dados estat√≠sticos**:\n- Percentual de ocorr√™ncia de cada tema\n- N√≠vel m√©dio de desconforto por tema e subtema\n- Rankings de temas mais relevantes\n\nüí° **Recomenda√ß√µes personalizadas** baseadas na classifica√ß√£o de risco (0-4):\n- Risco Ausente (0): <0.5\n- Risco Baixo (1): 0.5-1.5\n- Risco Moderado (2): 1.5-2.5\n- Risco Alto (3): 2.5-3.5\n- Risco Cr√≠tico (4): >3.5\n\nPermite filtrar por empresa e/ou departamento para an√°lises espec√≠ficas.",
        "operationId": "gerarRelatorio",
        "parameters": [
          {
            "name": "empresa",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Nome da empresa para filtrar resultados (opcional)"
          },
          {
            "name": "departamento",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Departamento espec√≠fico para filtrar resultados (opcional)"
          }
        ],
        "responses": {
          "200": {
            "description": "‚úì Relat√≥rio gerado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RelatorioEstatistico"
                }
              }
            }
          },
          "404": {
            "description": "‚ö†Ô∏è Nenhuma avalia√ß√£o encontrada com os filtros informados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          },
          "500": {
            "description": "‚ùå Erro ao processar a solicita√ß√£o",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          }
        }
      }
    },
    "/inicializar_db": {
      "post": {
        "tags": ["administra√ß√£o"],
        "summary": "Configure o banco de dados com os dados iniciais",
        "description": "Inicializa o sistema criando e populando o banco de dados com todos os dados necess√°rios:\n\nüèóÔ∏è **Estruturas criadas**:\n- 5 Macrotemas principais (A-E)\n- 20 Temas numerados\n- Todos os subtemas correspondentes\n- Recomenda√ß√µes para cada tema e n√≠vel de risco (0-4)\n\n‚ö†Ô∏è **Importante**: Esta opera√ß√£o √© segura de executar m√∫ltiplas vezes, pois verifica se o banco j√° est√° populado antes de fazer altera√ß√µes.",
        "operationId": "inicializarDb",
        "responses": {
          "200": {
            "description": "‚úì Banco de dados configurado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mensagem": {
                      "type": "string",
                      "example": "Banco de dados inicializado com sucesso!"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "‚ùå Erro ao processar a solicita√ß√£o",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          }
        }
      }
    },
    "/limpar_avaliacoes_duplicadas": {
      "delete": {
        "tags": ["administra√ß√£o"],
        "summary": "Remova avalia√ß√µes duplicadas do sistema",
        "description": "Identifica e remove avalia√ß√µes duplicadas para a mesma empresa e departamento, mantendo apenas a avalia√ß√£o mais recente para cada combina√ß√£o. √ötil para limpeza de dados e corre√ß√£o de problemas de submiss√£o m√∫ltipla.",
        "operationId": "limparAvaliacoesDuplicadas",
        "responses": {
          "200": {
            "description": "‚úì Avalia√ß√µes duplicadas removidas com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "mensagem": {
                      "type": "string",
                      "example": "5 avalia√ß√µes duplicadas foram removidas."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "‚ùå Erro ao processar a solicita√ß√£o",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Erro"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "QuestionarioHierarquico": {
        "type": "object",
        "required": ["questionario"],
        "properties": {
          "questionario": {
            "type": "array",
            "description": "Lista dos 5 macrotemas com seus temas e subtemas",
            "items": {
              "$ref": "#/components/schemas/MacroTema"
            }
          }
        }
      },
      "MacroTema": {
        "type": "object",
        "required": ["id", "codigo", "titulo", "temas"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID √∫nico do macrotema no banco de dados"
          },
          "codigo": {
            "type": "string",
            "description": "Letra que identifica o macrotema (A a E)",
            "example": "A"
          },
          "titulo": {
            "type": "string",
            "description": "T√≠tulo descritivo do macrotema",
            "example": "Sobre diferentes cargas de trabalho"
          },
          "temas": {
            "type": "array",
            "description": "Lista de temas neste macrotema",
            "items": {
              "$ref": "#/components/schemas/Tema"
            }
          }
        }
      },
      "Tema": {
        "type": "object",
        "required": ["id", "numero", "descricao", "subtemas"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID √∫nico do tema no banco de dados"
          },
          "numero": {
            "type": "integer",
            "description": "N√∫mero sequencial do tema (1-20)",
            "example": 1
          },
          "descricao": {
            "type": "string",
            "description": "Descri√ß√£o completa do tema",
            "example": "Meu trabalho √© caracterizado por alta intensidade e um ritmo acelerado de trabalho."
          },
          "subtemas": {
            "type": "array",
            "description": "Lista de subtemas deste tema",
            "items": {
              "$ref": "#/components/schemas/Subtema"
            }
          }
        }
      },
      "Subtema": {
        "type": "object",
        "required": ["id", "letra", "descricao"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID √∫nico do subtema no banco de dados"
          },
          "letra": {
            "type": "string",
            "description": "Letra que identifica o subtema dentro do tema",
            "example": "a"
          },
          "descricao": {
            "type": "string",
            "description": "Texto completo da pergunta do subtema",
            "example": "Preciso trabalhar muito r√°pido ou com muito esfor√ßo ao longo do dia"
          }
        }
      },
      "NovaAvaliacao": {
        "type": "object",
        "required": ["empresa", "departamento", "respostas_nivel1", "respostas_nivel2"],
        "properties": {
          "empresa": {
            "type": "string",
            "description": "Nome da empresa sendo avaliada",
            "example": "PUC-Rio"
          },
          "departamento": {
            "type": "string",
            "description": "Departamento ou setor espec√≠fico",
            "example": "Engenharias"
          },
          "funcao": {
            "type": "string",
            "description": "Fun√ß√£o ou cargo do respondente (opcional)",
            "example": "Professor"
          },
          "respostas_nivel1": {
            "type": "array",
            "description": "Respostas do primeiro n√≠vel (sele√ß√£o dos temas relevantes)",
            "items": {
              "$ref": "#/components/schemas/RespostaNivel1"
            }
          },
          "respostas_nivel2": {
            "type": "array",
            "description": "Respostas do segundo n√≠vel (grau de desconforto para subtemas)",
            "items": {
              "$ref": "#/components/schemas/RespostaNivel2"
            }
          }
        }
      },
      "RespostaNivel1": {
        "type": "object",
        "required": ["tema_id", "selecionado"],
        "properties": {
          "tema_id": {
            "type": "integer",
            "description": "ID do tema sendo respondido",
            "example": 1
          },
          "selecionado": {
            "type": "boolean",
            "description": "Se o tema foi marcado como relevante (verdadeiro) ou n√£o (falso)",
            "example": true
          }
        }
      },
      "RespostaNivel2": {
        "type": "object",
        "required": ["subtema_id", "nivel_desconforto"],
        "properties": {
          "subtema_id": {
            "type": "integer",
            "description": "ID do subtema sendo avaliado",
            "example": 1
          },
          "nivel_desconforto": {
            "type": "integer",
            "description": "N√≠vel de desconforto (0=nenhum, 5=extremo)",
            "minimum": 0,
            "maximum": 5,
            "example": 3
          }
        }
      },
      "RespostaAvaliacao": {
        "type": "object",
        "required": ["mensagem", "id"],
        "properties": {
          "mensagem": {
            "type": "string",
            "description": "Mensagem de confirma√ß√£o",
            "example": "Avalia√ß√£o cadastrada com sucesso"
          },
          "id": {
            "type": "integer",
            "description": "ID da avalia√ß√£o criada",
            "example": 42
          }
        }
      },
      "RelatorioEstatistico": {
        "type": "object",
        "required": ["total_avaliacoes", "empresa", "departamento", "temas"],
        "properties": {
          "total_avaliacoes": {
            "type": "integer",
            "description": "N√∫mero de avalia√ß√µes inclu√≠das na an√°lise",
            "example": 25
          },
          "empresa": {
            "type": "string",
            "description": "Empresa analisada ou 'Todas'",
            "example": "PUC-Rio"
          },
          "departamento": {
            "type": "string",
            "description": "Departamento analisado ou 'Todos'",
            "example": "Engenharias"
          },
          "temas": {
            "type": "array",
            "description": "Lista de temas com suas estat√≠sticas detalhadas",
            "items": {
              "$ref": "#/components/schemas/TemasEstatistica"
            }
          }
        }
      },
      "TemasEstatistica": {
        "type": "object",
        "required": ["tema", "descricao", "contagem", "percentual", "nivel_medio", "macrotema", "subtemas", "recomendacoes"],
        "properties": {
          "tema": {
            "type": "integer",
            "description": "N√∫mero identificador do tema (1-20)",
            "example": 1
          },
          "descricao": {
            "type": "string",
            "description": "Descri√ß√£o completa do tema",
            "example": "Meu trabalho √© caracterizado por alta intensidade e um ritmo acelerado de trabalho."
          },
          "contagem": {
            "type": "integer",
            "description": "Quantidade de avalia√ß√µes que selecionaram este tema",
            "example": 18
          },
          "percentual": {
            "type": "number",
            "format": "float",
            "description": "Porcentagem de ocorr√™ncia nas avalia√ß√µes (0-100)",
            "example": 72.0
          },
          "macrotema": {
            "type": "string",
            "description": "C√≥digo do macrotema (A-E) a que pertence",
            "example": "A"
          },
          "nivel_medio": {
            "type": "number",
            "format": "float",
            "description": "M√©dia do n√≠vel de desconforto para este tema",
            "example": 3.5
          },
          "subtemas": {
            "type": "array",
            "description": "Estat√≠sticas detalhadas para cada subtema",
            "items": {
              "$ref": "#/components/schemas/SubtemaEstatistica"
            }
          },
          "recomendacoes": {
            "type": "array",
            "description": "Lista de recomenda√ß√µes conforme o n√≠vel de risco",
            "items": {
              "type": "string"
            },
            "example": [
              "Redistribuir urgentemente a carga de trabalho, limitar horas extras e implementar apoio adicional para equipes sobrecarregadas."
            ]
          }
        }
      },
      "SubtemaEstatistica": {
        "type": "object",
        "required": ["letra", "descricao", "nivel_medio"],
        "properties": {
          "letra": {
            "type": "string",
            "description": "Letra identificadora do subtema",
            "example": "a"
          },
          "descricao": {
            "type": "string",
            "description": "Texto completo do subtema",
            "example": "Preciso trabalhar muito r√°pido ou com muito esfor√ßo ao longo do dia"
          },
          "nivel_medio": {
            "type": "number",
            "format": "float",
            "description": "M√©dia do n√≠vel de desconforto para este subtema",
            "example": 3.8
          }
        }
      },
      "Erro": {
        "type": "object",
        "properties": {
          "erro": {
            "type": "string",
            "description": "Descri√ß√£o do erro ocorrido",
            "example": "Dados de entrada inv√°lidos ou incompletos"
          },
          "detalhes": {
            "type": "string",
            "description": "Informa√ß√µes adicionais sobre o erro (quando dispon√≠veis)",
            "example": "O campo 'empresa' √© obrigat√≥rio"
          }
        }
      }
    }
  }
}